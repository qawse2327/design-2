<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì´¬ì˜ í™”ë©´</title>
<style>
body { 
    background:#000; 
    color:white; 
    text-align:center; 
    font-family:"Noto Sans KR", sans-serif; 
}
video, #preview img { 
    width:300px; 
    border-radius:10px; 
    transition: 0.5s all;
}

/* preview div ì•ˆì˜ ì´ë¯¸ì§€ í…Œë‘ë¦¬ ìŠ¤íƒ€ì¼ */
#preview img.video-neon {
    box-shadow: 0 0 10px #0ff, 0 0 20px #0ff, 0 0 30px #0ff, 0 0 40px #0ff;
    border: 2px solid #0ff;
}

button { 
    margin:10px; 
    padding:10px 20px; 
    cursor:pointer; 
    font-size:16px; 
    border:none; 
    border-radius:8px; 
}

/* ì¤‘ì•™ ì¹´ìš´íŠ¸ë‹¤ìš´ ìˆ«ì ìŠ¤íƒ€ì¼ */
#countdown {
    font-size:50px;
    color:#0ff; /* ì•¼ê´‘ ì²­ë¡ìƒ‰ */
    margin-top:10px;
    font-weight:bold;
    text-shadow: 
        0 0 5px #0ff,
        0 0 10px #0ff,
        0 0 15px #0ff,
        0 0 20px #0ff;
}

/* video ì•¼ê´‘ í…Œë‘ë¦¬ */
.video-neon {
    box-shadow: 0 0 10px #0ff, 0 0 20px #0ff, 0 0 30px #0ff, 0 0 40px #0ff;
    border: 2px solid #0ff;
}
</style>
</head>
<body>
<h1>ì´¬ì˜ í™”ë©´</h1>

<video id="video" autoplay></video>
<div id="countdown"></div>
<div id="preview"></div>

<button onclick="startCountdown()">5ì´ˆ ë’¤ ì´¬ì˜</button>
<button onclick="location.href='/select'">ë‹¤ìŒ</button>

<script>
let video = document.getElementById("video");
let canvas = document.createElement("canvas");
let countdownEl = document.getElementById("countdown");
let previewDiv = document.getElementById("preview");

// ì¹´ë©”ë¼ ì ‘ê·¼
navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}})
  .then(stream => video.srcObject = stream)
  .catch(err => alert("ì¹´ë©”ë¼ ì ‘ê·¼ ì‹¤íŒ¨: " + err));

function startCountdown() {
  let count = 5;
  countdownEl.textContent = count;

  // ë°˜ë³µ ì´¬ì˜ ì‹œ ê¸°ì¡´ ì•¼ê´‘ ì œê±°
  video.classList.remove("video-neon");
  if (previewDiv.firstChild) {
      previewDiv.firstChild.classList.remove("video-neon");
  }

  let timer = setInterval(() => {
    count--;
    if (count > 0) {
      countdownEl.textContent = count;
    } else {
      clearInterval(timer);
      countdownEl.textContent = "";

      // ì¹´ìš´íŠ¸ ì™„ë£Œ í›„ ì•¼ê´‘ íš¨ê³¼ ì¬ì ìš©
      video.classList.add("video-neon");

      capture();
    }
  }, 1000);
}

function capture() {
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  canvas.getContext("2d").drawImage(video, 0, 0);
  let image = canvas.toDataURL("image/jpeg");

  // previewì— ì´ë¯¸ì§€ í‘œì‹œ + ì•¼ê´‘ í…Œë‘ë¦¬ ì ìš©
  previewDiv.innerHTML = `<img src="${image}" class="video-neon">`;

  // ì„œë²„ì— ì—…ë¡œë“œ
  fetch("/upload", {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({image})
  }).then(res => {
    if (res.ok) console.log("ğŸ“¸ ì‚¬ì§„ ì—…ë¡œë“œ ì™„ë£Œ");
  });
}
</script>
</body>
</html>
